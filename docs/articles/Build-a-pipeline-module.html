<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Build-a-pipeline-module tutorial • Prostar2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Build-a-pipeline-module tutorial">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Prostar2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.13</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/Prostar2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Build-a-pipeline-module.html">Build-a-pipeline-module tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/Create-a-new-pipeline-tutorial.html">Create-a-new-pipeline-tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/PipelineProtein_Filtering.html">Workflow Protein: Filtering</a></li>
    <li><a class="dropdown-item" href="../articles/Prostar_dev_guideline.html">Inside Prostar core</a></li>
    <li><a class="dropdown-item" href="../articles/Prostar_workflow_tutorial.html">Prostar navigation tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/Prostar_workflow_userguide.html">Inside Prostar core 2</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/edyp-lab/Prostar2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Build-a-pipeline-module tutorial</h1>
                        <h4 data-toc-skip class="author">Samuel
Wieczorek</h4>
                        
      
      <small class="dont-index">Source: <a href="https://github.com/edyp-lab/Prostar2/blob/HEAD/vignettes/Build-a-pipeline-module.Rmd" class="external-link"><code>vignettes/Build-a-pipeline-module.Rmd</code></a></small>
      <div class="d-none name"><code>Build-a-pipeline-module.Rmd</code></div>
    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      <p>This vignette describes how to develop a module for a treatment
      process in prostar. Such a process is part of a pipeline.</p>
    </div>
    
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>A data processing module in Prostar is an independant Shinyapp which
operate one or several treatments to a dataset. Its input has at least
one dataset and its output is at least the modified input dataset. As in
Prostar (&gt;=2.0.0), the class of the dataset is QFeatures. The aim of
this tutorial is to show how to develop a process module for Prostar (ie
a module which belongs to a pipeline and operates transformations on the
dataset). Along this tutorial, one will create a module with 3 steps and
aims to modify some values in the input dataset. For that, we will also
use another module available in Prostar: the navigation module which
manages modules wkith several steps.</p>
</div>
<div class="section level2">
<h2 id="global-architecture-of-the-module">Global architecture of the module<a class="anchor" aria-label="anchor" href="#global-architecture-of-the-module"></a>
</h2>
<p>A process module can be seen as a blackbox with inputs and outputs.
As it must be self-contained, all informations (global variables, etc..)
needed by the module are created and instanciated inside the module.
However, when some information are managed in a module and are used by a
large number of modules in Prostar, they can be passed as
parameters.</p>
<p>Modules of processes can use one or several screens UIs. In the later
case, we will use the navigation module which provides an engine to
manage the set of steps for a module. Thus, the development of a process
module only consists in coding the UI and server-side functions ; the
managment of the sequence of steps is devoted to the navigation
process.</p>
<p>From the file where the module is called, it is often useful to keep
the result of this module in a reactive variable, so as to get directly
access to a change in the return value of the module.</p>
<p>For this example, one assume that cxxxxx. All the following code is
from the file dev/module_pipeline_process_skeleton.R. In the following
parts, we detail each part of this code</p>
<p>The module that will be built is named <em>pipe_process</em> and have
thw two functions present in a shiny module: the ui side
(<strong>mod_pipe_process_ui</strong>) and the server side
(<strong>mod_pipe_process_server</strong>).</p>
</div>
<div class="section level2">
<h2 id="ui-side-function">Ui-side function<a class="anchor" aria-label="anchor" href="#ui-side-function"></a>
</h2>
<p>Here is a typical ui function of a shiny module with the call to the
‘NS’ function. The most important line is the declaration of the UI for
the navigation module <em>mod_navigation_ui</em> which is used to manage
the screens of the module. Those screens are not displayed by the
process module itself but they are sent to the navigation module. That
is the reason why no declaration for the ui of the process module is
present in this function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_pipe_process_ui</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/NS.html" class="external-link">NS</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span>  <span class="fu">mod_navigation_ui</span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">'nav_pipe_process'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="server-side-function">Server-side function<a class="anchor" aria-label="anchor" href="#server-side-function"></a>
</h2>
<p>In this section, on describes all the necessary code for making the
module runnable. Several steps are needed:</p>
<ul>
<li>Declaring reactive variables for the navigation module and the
process module itself</li>
<li>xxx</li>
<li>xxxx</li>
<li>xxxx</li>
</ul>
<p>They are detailed in the following sections.</p>
</div>
<div class="section level2">
<h2 id="declaring-reactive-variables">Declaring reactive variables<a class="anchor" aria-label="anchor" href="#declaring-reactive-variables"></a>
</h2>
<p>Two types of reactive variables are used in a process module:</p>
<ul>
<li>
<strong>r.nav</strong>: a list of variables sent to the navigation
module to manage screens</li>
<li>
<strong>rv.process</strong>: a list of specific variables used by
the module process</li>
</ul>
<p>The following code defines the reactive variable to interact with the
navigation module:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="co">## Section navigation module</span></span>
<span>  <span class="co"># Variable to manage the different screens of the module</span></span>
<span>  <span class="va">r.nav</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactiveValues.html" class="external-link">reactiveValues</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Foo"</span>,</span>
<span>    stepsNames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Choose assay"</span>, <span class="st">"Change"</span>, <span class="st">"Save"</span><span class="op">)</span>,</span>
<span>    ll.UI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> screenStep1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html" class="external-link">uiOutput</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"Screen_Process_1"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  screenStep2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html" class="external-link">uiOutput</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"Screen_Process_2"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  screenStep3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html" class="external-link">uiOutput</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"Screen_Process_3"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    isDone <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>    mandatory <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>    reset <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The name (<strong>r.nav</strong>) of the reactiveValues is always the
same in all modules that could be develop in Prostar. The list is
composed of the following items:</p>
<ul>
<li>
<strong>name</strong>: The id of the navigation process.</li>
<li>
<strong>stepsNames</strong>: A vector of names where each element
correspond to a step of the process. These names are written at each
point of the timeline in the navigation process,</li>
<li>
<strong>ll.UI</strong>: A list of uiOutput functions where each one
correspond to a screen (UI) of the process. In order to respect the same
nomenclature all over Prostar’s code, it is advised to name the
different elements of the list as in the example. For example, for the
ith step, one would write:
screenStepi=uiOutput(ns(“Screen_Process_i)),</li>
<li>
<strong>isDone</strong>: A vector of boolean which length is equal
to the number of steps in the process. Each element indicates whether
the corresponding step has been done. If it is the case, then the
navigation module change the color of the timeline (e.g. from red to
green) and enable the ‘next’ button.</li>
<li>
<strong>mandatory</strong>: A vector of boolean which length is
equal to the number of steps in the process. Each element indicates
whether the corresponding step is mandatory in the process or not. If it
is, then it is colored in red when undone and the user cannot skip this
step in the navigation module. If it is not mandatory, the default color
is orange and the user can skip it. If a step is mandatory, it must be
tagged as Done to go to the next step.</li>
<li>
<strong>reset</strong>: A boolean which indicates to the navigation
process if it has to reset all widgets of the module or not.</li>
</ul>
<p>These values are default values and may change during the use of the
module.</p>
<p>Then, we describe the reactive variables specific to the module
process. In general, it is good to name this list with the prefix ‘rv.’
followed by the name of the process. For example, for the normalization
process, one can create a list named ‘rv.norm’.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rv.process</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactiveValues.html" class="external-link">reactiveValues</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"processProtNorm"</span>,</span>
<span>  dataIn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dataOut <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  widgets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>assay <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                 operator <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                 operand <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ul>
<li>
<strong>name</strong>: the id of the process. This name is important
because it is used seveal times by the core of Prostar. It must be
referenced in only one pipeline (see the file R/config.R)</li>
<li>
<strong>dataIn</strong>: A QFeatures object</li>
<li>
<strong>i</strong>: the indice of the dataset in the QFeatures
object on which operations have to be processed</li>
<li>
<strong>dataOut</strong>: A QFeatures object which is the return
value of the module</li>
<li>
<strong>widgets</strong>: A list of values for all the widgets used
in the process module. This list acts as temporary reactive variables
for the widgets. They also can initialise the widgets and set them to as
custom default value. These are the variables that are used all over the
code of the module (one do not manipulate the value of the widgets from
input[[]], except to instantiate this list)</li>
</ul>
</div>
<div class="section level2">
<h2 id="reset-function">Reset function<a class="anchor" aria-label="anchor" href="#reset-function"></a>
</h2>
<p>In this function (observeEvent), we look at the changes of the
reactive variable r.nav$reset. The changes of this variable occur within
the module navigation process (with an actionButton) and its new value
will be automatically viewed by the process module.</p>
<p>When its value is equal to TRUE, all the reactive variables in the
module process are set to their initial value.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">r.nav</span><span class="op">$</span><span class="va">reset</span><span class="op">)</span>,<span class="op">{</span></span>
<span>    </span>
<span>  <span class="co"># Just for the example: set the widget to its default value</span></span>
<span>  <span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>assay <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                             operand <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                             operator <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## do not modify this part</span></span>
<span>  <span class="co"># Set the dataIn object to the original object sent to the process module</span></span>
<span>  <span class="va">rv.process</span><span class="op">$</span><span class="va">dataIn</span> <span class="op">&lt;-</span> <span class="fu">obj</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">rv.process</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#All the steps are undone</span></span>
<span>  <span class="va">r.nav</span><span class="op">$</span><span class="va">isDone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Set the reset variable back to FALSE (if we are in this observeEvent, it is because the variable has been set to TRUE)</span></span>
<span>  <span class="va">r.nav</span><span class="op">$</span><span class="va">reset</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>    <span class="co">## end of no modifiable part</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="managing-the-indice-of-assay">Managing the indice of assay<a class="anchor" aria-label="anchor" href="#managing-the-indice-of-assay"></a>
</h2>
<p>By default (in a pipeline), when a dataset (QFeatures) have to be
processed, the treatment operates on the last assay of the dataset. It
then adds a new assay at the end of the assay list.</p>
<p>However, the user may want to redo a previous treatment. Then, it
specifies the assay he wants to work on. In order to guarantee that the
succession of assays are consistent with the pipeline direction, all the
assays placed after the one he indicated are to be deleted before
proceeding. In this case, onpopup window will appear to inform the user.
He has the choice to accept or to decline. In the latter case, the
interface of the module is kept disabled.</p>
<p>The management of the popup window is done with the package
‘shinyalert’. For that purpose, some pieces of code are necessary.</p>
<p>ui part</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">useShinyalert</span>(),</span></code></pre></div>
<p>server part</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">rv.filter</span><span class="op">$</span><span class="va">dataIn</span>, <span class="va">rv.filter</span><span class="op">$</span><span class="va">i</span> <span class="op">)</span>, <span class="op">{</span></span>
<span>    <span class="va">a</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rv.filter</span><span class="op">$</span><span class="va">dataIn</span><span class="op">)</span> <span class="op">!=</span> <span class="va">rv.filter</span><span class="op">$</span><span class="va">i</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="va">r.nav</span><span class="op">$</span><span class="va">isDone</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r.nav</span><span class="op">$</span><span class="va">isDone</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">a</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">shinyalert</span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="st">'title'</span>,</span>
<span>      text <span class="op">=</span> <span class="st">"This is a modal"</span>,</span>
<span>      size <span class="op">=</span> <span class="st">"xs"</span>, </span>
<span>      closeOnEsc <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      closeOnClickOutside <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      html <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"info"</span>,</span>
<span>      showConfirmButton <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      showCancelButton <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      confirmButtonText <span class="op">=</span> <span class="st">"OK"</span>,</span>
<span>      confirmButtonCol <span class="op">=</span> <span class="st">"#15A4E6"</span>,</span>
<span>      cancelButtonText <span class="op">=</span> <span class="st">"Cancel"</span>,</span>
<span>      timer <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      imageUrl <span class="op">=</span> <span class="st">""</span>,</span>
<span>      animation <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">input</span><span class="op">$</span><span class="va">shinyalert</span></span>
<span>    <span class="va">rv.filter</span><span class="op">$</span><span class="va">i</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">shinyalert</span><span class="op">)</span><span class="op">)</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">c1</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">shinyalert</span></span>
<span>    <span class="va">c2</span> <span class="op">&lt;-</span> <span class="va">rv.filter</span><span class="op">$</span><span class="va">i</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rv.filter</span><span class="op">$</span><span class="va">dataIn</span><span class="op">)</span></span>
<span>    <span class="va">c3</span> <span class="op">&lt;-</span> <span class="va">r.nav</span><span class="op">$</span><span class="va">isDone</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r.nav</span><span class="op">$</span><span class="va">isDone</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">c1</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="va">c2</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="va">c3</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="co">#Delete all assays after that one indicated by the indice given in parameter</span></span>
<span>      <span class="va">rv.filter</span><span class="op">$</span><span class="va">dataIn</span> <span class="op">&lt;-</span> <span class="va">rv.filter</span><span class="op">$</span><span class="va">dataIn</span><span class="op">[</span> , , <span class="op">-</span><span class="op">(</span><span class="op">(</span><span class="va">rv.filter</span><span class="op">$</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rv.filter</span><span class="op">$</span><span class="va">dataIn</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>      <span class="va">c1</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">shinyalert</span></span>
<span>      <span class="va">c2</span> <span class="op">&lt;-</span> <span class="va">rv.filter</span><span class="op">$</span><span class="va">i</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rv.filter</span><span class="op">$</span><span class="va">dataIn</span><span class="op">)</span></span>
<span>      <span class="va">c3</span> <span class="op">&lt;-</span> <span class="va">r.nav</span><span class="op">$</span><span class="va">isDone</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r.nav</span><span class="op">$</span><span class="va">isDone</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="co"># Do nothing, the module interface is still disabled</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu">shinyjs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shinyjs/man/stateFuncs.html" class="external-link">toggleState</a></span><span class="op">(</span><span class="st">'div_nav_pipe_process'</span>, condition <span class="op">=</span> <span class="op">!</span><span class="va">c3</span> <span class="op">&amp;&amp;</span> <span class="op">(</span><span class="va">c1</span><span class="op">||</span><span class="va">c2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="observe-for-module-parameters">Observe for module parameters<a class="anchor" aria-label="anchor" href="#observe-for-module-parameters"></a>
</h2>
<p>In this section, there is an observe function to set the local
reactive variable with the values of parameters of the module. These
local variables are used as temporary reactive variables.</p>
<p>The last thing in this section is to observe changes in the
parameters of the module. This is done by adding an observe function
where the values of each parameter are used to set the reactive values
of the module process:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="fu">obj</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">rv.process</span><span class="op">$</span><span class="va">dataIn</span> <span class="op">&lt;-</span> <span class="fu">obj</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="call-for-navigation-module">Call for navigation module<a class="anchor" aria-label="anchor" href="#call-for-navigation-module"></a>
</h2>
<p>After the previous code, one can place the line to call the
navigation module (server-side). It cannot be placed above because we
need both r.nav and rv.process variables</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/callModule.html" class="external-link">callModule</a></span><span class="op">(</span><span class="va">mod_navigation_server</span>, <span class="st">'nav_pipe_process'</span>, style<span class="op">=</span><span class="fl">2</span>, pages<span class="op">=</span><span class="va">r.nav</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calls-to-other-modules">Calls to other modules<a class="anchor" aria-label="anchor" href="#calls-to-other-modules"></a>
</h2>
<p>Here, one can put the call to other modules used in the process
module. For example, if one want to include the module settings, add the
following line</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rv.process</span><span class="op">$</span><span class="va">settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/callModule.html" class="external-link">callModule</a></span><span class="op">(</span><span class="va">mod_settings_server</span>,</span>
<span>                                 <span class="st">"settings"</span>, </span>
<span>                                 obj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span><span class="fu">obj</span><span class="op">(</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="definition-of-the-screens">Definition of the screens<a class="anchor" aria-label="anchor" href="#definition-of-the-screens"></a>
</h2>
<p>For each screen declared previously (the ‘uiOutput’ in the
r.nav$ll.UI list), there is a corresponding renderUI function.</p>
<p>Note: The content of these screens is for educational purpose and is
not mandatory for the process module. The only necessary code is the
list of the screens.</p>
<p>Each screen section contains the renderUI function and the set of
functions used to make the screen work</p>
<div class="section level3">
<h3 id="screen-1">Screen 1<a class="anchor" aria-label="anchor" href="#screen-1"></a>
</h3>
<p>In the first function, one declare a selectInput widget to choose the
assay on which operations will be done</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span><span class="op">$</span><span class="va">Screen_Process_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">selectInpput</span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">'selectAssay'</span><span class="op">)</span>, </span>
<span>                 <span class="st">'Select assay'</span>, </span>
<span>                 choices<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rv.process</span><span class="op">$</span><span class="va">dataIn</span><span class="op">)</span>, </span>
<span>                 selected<span class="op">=</span><span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">assay</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>For each input declared in UI functions, there must be on
observeEvent to watch its value and instanciate the corresponding
reactive value in the list named <em>rv.process$widgets</em>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">selectAssay</span>, <span class="op">{</span></span>
<span>    <span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">assay</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">selectAssay</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The last function for the screen 1 is used to watch the variable
<em>rv.process<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mi>i</mi><mi>d</mi><mi>g</mi><mi>e</mi><mi>t</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">widgets</annotation></semantics></math>assay</em>.
If its value is greater then 0 (i.e. the user has selected an assay in
the QFeatures object), then he can pass to the second step of the
module. For that, the first element of the vector r.nav$isDone is set to
TRUE, telling the navigation process to change the color in the timeline
(see xxx).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">assay</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span>        <span class="va">r.nav</span><span class="op">$</span><span class="va">isDone</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="screen-2">Screen 2<a class="anchor" aria-label="anchor" href="#screen-2"></a>
</h3>
<p>In the second screen, three widgets are defined:</p>
<ul>
<li>a radioButtons to choose which operation will be applied to the
dataset,</li>
<li>a numericInput to choose the other operand,</li>
<li>an actionButton to apply changes in the temporary reactive
variable.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">output</span><span class="op">$</span><span class="va">Screen_Process_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/radioButtons.html" class="external-link">radioButtons</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">'operator'</span><span class="op">)</span>, <span class="st">'Choose operator'</span>,</span>
<span>                 choices <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'addition'</span> <span class="op">=</span> <span class="st">'addition'</span>,</span>
<span>                               <span class="st">'soustraction'</span> <span class="op">=</span> <span class="st">'soustraction'</span>,</span>
<span>                               <span class="st">'product'</span> <span class="op">=</span> <span class="st">'product'</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">'operand'</span><span class="op">)</span>, </span>
<span>                 <span class="st">'Choose operand'</span>, </span>
<span>                 value <span class="op">=</span> <span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">operand</span>, </span>
<span>                 min<span class="op">=</span><span class="fl">0</span>, </span>
<span>                 max<span class="op">=</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html" class="external-link">actionButton</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">'change'</span><span class="op">)</span>, <span class="st">'Apply operator'</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>As previously, there are observe functions to update each of the
widgets reactive values.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">operator</span>, ignoreInit<span class="op">=</span><span class="cn">TRUE</span>,<span class="op">{</span></span>
<span>    <span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">operator</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">operator</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">operand</span>, ignoreInit<span class="op">=</span><span class="cn">TRUE</span>,<span class="op">{</span></span>
<span>    <span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">operand</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">operand</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Here, the validation of the step is not processed by the watching of
a reactive variable but is made by an actionButton. When the user clicks
on the button, the operation is done on the dataset. The variable
<em>rv.process<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>I</mi><mi>n</mi><mo>*</mo><mi>i</mi><mi>s</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>n</mi><mi>u</mi><mi>p</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>w</mi><mi>i</mi><mi>t</mi><mi>h</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>n</mi><mi>e</mi><mi>w</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mi>.</mi><mi>T</mi><mi>h</mi><mi>e</mi><mi>v</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mo>*</mo><mi>r</mi><mi>v</mi><mi>.</mi><mi>p</mi><mi>r</mi><mi>o</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">dataIn* is then updated with the new value. The variable *rv.process</annotation></semantics></math>dataOut</em>
is not yet instantiated because other steps may occur in the module and
they need a temporary variable. Finally, the vector
<em>r.nav$isDone</em> is updated.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">change</span>,<span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">rv.process</span><span class="op">$</span><span class="va">dataIn</span><span class="op">[[</span><span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">assay</span><span class="op">]</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span> <span class="op">(</span><span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">operator</span>,</span>
<span>            addition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span> <span class="op">+</span> <span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">operand</span>,</span>
<span>            soustraction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span> <span class="op">-</span> <span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">operand</span>,</span>
<span>            product <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span> <span class="op">*</span> <span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">operand</span></span>
<span>    <span class="op">)</span></span>
<span>   </span>
<span>    <span class="va">rv.process</span><span class="op">$</span><span class="va">dataIn</span> <span class="op">&lt;-</span> <span class="fu">QFeatures</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/QFeatures/man/QFeatures-class.html" class="external-link">addAssay</a></span><span class="op">(</span><span class="va">rv.process</span><span class="op">$</span><span class="va">dataIn</span>,</span>
<span>                                            <span class="va">tmp</span>,</span>
<span>                                            <span class="st">'tutorial'</span><span class="op">)</span></span>
<span>    <span class="va">r.nav</span><span class="op">$</span><span class="va">isDone</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="screen-3">Screen 3<a class="anchor" aria-label="anchor" href="#screen-3"></a>
</h3>
<p>In this last screen, an actionButton is defined to validate all the
changes that have been processed in the module.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">output</span><span class="op">$</span><span class="va">Screen_Process_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html" class="external-link">actionButton</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"save"</span><span class="op">)</span>, <span class="st">"Save"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The validation is made via a watching function on the value of the
actionButton. An important point is to set the <em>Params</em> list in
the metadata of the recently created assay of the QFeatures object. This
is a manner to keep in memory all the parameters that have conducted to
this new assay. Those parameters will also be used in other modules of
Prostar.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">save</span>,<span class="op">{</span> </span>
<span>      <span class="fu">metadata</span><span class="op">(</span><span class="va">rv.process</span><span class="op">$</span><span class="va">dataIn</span><span class="op">[[</span><span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">assay</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">Params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                          operand <span class="op">=</span> <span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">operand</span>,</span>
<span>                          operator <span class="op">=</span> <span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">operator</span></span>
<span>                          <span class="op">)</span></span>
<span></span>
<span>      <span class="va">rv.process</span><span class="op">$</span><span class="va">dataOut</span> <span class="op">&lt;-</span> <span class="va">rv.process</span><span class="op">$</span><span class="va">dataIn</span></span>
<span>      <span class="va">r.nav</span><span class="op">$</span><span class="va">isDone</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Once the parameters have been saved, the variable
<em>rv.process$dataOut</em> is set with the current dataset. From this
time, the return of the module is functional (the value is not NULL) and
the caller module will receive an update value.</p>
</div>
<div class="section level3">
<h3 id="validating-the-steps">Validating the steps<a class="anchor" aria-label="anchor" href="#validating-the-steps"></a>
</h3>
<p>To validate a step, one have to observe an event which can be:</p>
<ul>
<li>an event triggered by a widget (i.e. an actionButton)</li>
<li>a test on one or several variables in the process module.</li>
</ul>
<p>In this example, for the first step,the event is triggered by an
action button named ‘perform1’. When the user has selected the right
column to change in the dataset (via the widget selectInput), he clicks
on the ‘perform1’ button. Then:</p>
<ol style="list-style-type: decimal">
<li>the value of the selected column is stored in another reactive
variable,</li>
<li>The first position of the variable r.nav$isDone is set to TRUE. That
indicates to the navigation module to color in green the corresponding
label. The other effect is that it enables the ‘Next’ button to go to
the second step.</li>
</ol>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">perform1</span>,<span class="op">{</span></span>
<span>    <span class="va">rv.process</span><span class="op">$</span><span class="va">column</span> <span class="op">&lt;-</span> <span class="va">rv.process</span><span class="op">$</span><span class="va">widget</span><span class="op">$</span><span class="va">column</span></span>
<span>    <span class="va">r.nav</span><span class="op">$</span><span class="va">isDone</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>There must be a reactive function for each step in the process
module. This function can be:</p>
<ul>
<li>An observe function</li>
<li>An observeEvent function</li>
<li>A reactive function</li>
</ul>
<p>The most important point is that this function contains a line to
indicate that the step is done. For the i th step, there must be the
following line:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>    r.nav<span class="sc">$</span>isDone[i] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  <span class="er">})</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="server-functions-for-process-module">Server functions for process module<a class="anchor" aria-label="anchor" href="#server-functions-for-process-module"></a>
</h3>
<p>At this step, one have declared all necessary functions for UI and
the management of widgets with reactive variables. It is time to code
the core functions of the process. For the example in this tutorial, one
have to write xxx functions:</p>
<ul>
<li>a function to modify the current dataset, triggered by the xxx
button</li>
<li>a function to save the dataset, that is to say to set the reactive
variable rv.process$dataOut</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">change</span>, <span class="op">{</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>In the second function, there is three steps:</p>
<ol style="list-style-type: decimal">
<li>the first line collects the value of all interesting widgets to put
them in the metadata of the dataset as a list named Params,</li>
<li>Set the dataOut variable to the value of the current dataset,</li>
<li>Set the third position of the isDone vector to TRU to indicate that
this step is done.</li>
</ol>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">save</span>,<span class="op">{</span> </span>
<span>    </span>
<span>      <span class="fu">metadata</span><span class="op">(</span><span class="va">rv.process</span><span class="op">$</span><span class="va">dataIn</span><span class="op">[[</span><span class="va">rv.process</span><span class="op">$</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">Params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        operand <span class="op">=</span> <span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">operand</span>,</span>
<span>        operator <span class="op">=</span> <span class="va">rv.process</span><span class="op">$</span><span class="va">widgets</span><span class="op">$</span><span class="va">operator</span>,</span>
<span>      <span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">rv.process</span><span class="op">$</span><span class="va">dataOut</span> <span class="op">&lt;-</span> <span class="va">rv.process</span><span class="op">$</span><span class="va">dataIn</span></span>
<span>      <span class="va">r.nav</span><span class="op">$</span><span class="va">isDone</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Note : It is not necessary to create specific variables for the input
of actionButtons because we do not need its value further. This
technique is only used for the widgets corresponding to parameters. By
doing this, one can keep the value all along the lifetime of the
module.</p>
</div>
<div class="section level3">
<h3 id="return-value-of-the-module">Return value of the module<a class="anchor" aria-label="anchor" href="#return-value-of-the-module"></a>
</h3>
<p>The return value of a module is always the reactive value named
dataOut. It is set at the final step of the module.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span><span class="va">rv.process</span><span class="op">$</span><span class="va">dataOut</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Samuel Wieczorek, Thomas Burger.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
